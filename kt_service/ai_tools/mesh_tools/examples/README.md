# Обзор примеров использования

`femm_generator.py` — это инструмент для генерации 2D треугольных сеток из контурных данных с классификацией элементов по классам. Результат может быть экспортирован в формате, совместимом с FEMM (Finite Element Method Magnetics) или визуализирован через Gmsh GUI или OpenCV.

## Основные возможности

- Создание треугольной сетки из полигональных контуров
- Классификация элементов сетки по заданным контурам
- Экспорт в текстовый формат для FEMM
- Визуализация через Gmsh GUI или OpenCV
- Оптимизация контуров (удаление коллинеарных точек)

## Примеры использования

### 1. Проектирование в архитектуре и дизайне

Файл: `create_architectural_facade.py`

```python
from EITSynthAI.mesh_service.femm_generator import test_module

def create_architectural_facade():
    """Создает сложный архитектурный фасад"""
    contours = [
        # Основной контур здания
        '0 0 0 600 0 600 400 500 400 500 450 100 450 100 400 0 400',
        # Цокольный этаж
        '1 20 20 580 20 580 100 20 100',
        # ... другие контуры
    ]
    return contours

test_module(create_architectural_facade())
```

**Особенности:**
- Определяет различные архитектурные элементы (этажи, окна, двери, колонны)
- Использует разные классы для разных элементов
- Создает реалистичную геометрию здания

### 2. Генеративное искусство - использование кода для создания эстетичных орнаментов

Файл: `create_generative_art.py`

```python
def create_generative_art():
    """Создает абстрактное генеративное искусство"""
    import random
    import math
    
    contours = []
    random.seed(42)
    
    # Базовый контур
    contours.append('0 0 0 500 0 500 500 0 500')
    
    # Концентрические слои со случайными колебаниями
    for layer in range(5):
        points = []
        num_points = 20 + layer * 5
        # ... генерация точек
        
    return contours
```

**Особенности:**
- Создает абстрактные узоры
- Использует математические функции (синусы, спирали)
- Включает правильные многоугольники

### 3. Визуализация механических узлов для инженерного ПО

Файл: `create_mechanical_assembly.py`

```python
def create_mechanical_assembly():
    """Создает сложный механический узел"""
    import math
    
    contours = []
    
    # Основная шестерня
    center_x, center_y = 200, 200
    radius_outer = 150
    teeth = 12
    
    # Генерация зубьев шестерни
    gear_points = []
    for i in range(teeth * 2):
        angle = i * math.pi / teeth
        if i % 2 == 0:
            r = radius_outer
        else:
            r = radius_outer - 20
        # ... расчет точек
        
    return contours
```

**Особенности:**
- Создает точную механическую геометрию
- Включает шестерни с зубьями
- Добавляет монтажные отверстия и соединительные элементы

## Как создать свой собственный пример

### Шаг 1: Определите структуру контуров

Каждый контур должен быть представлен в виде строки:
```
<class_id> x1 y1 x2 y2 ... xn yn
```

Где:
- `class_id` — целое число, идентификатор класса (0, 1, 2, ...)
- `x1 y1, x2 y2, ...` — координаты вершин полигона

### Шаг 2: Создайте функцию-генератор

```python
from EITSynthAI.mesh_service.femm_generator import test_module

def my_custom_example():
    """Описание вашего примера"""
    contours = []
    
    # 1. Внешний контур (обычно класс 0)
    contours.append('0 0 0 400 0 400 300 0 300')
    
    # 2. Внутренние элементы
    contours.append('1 50 50 350 50 350 250 50 250')
    
    # 3. Детали
    contours.append('2 100 100 150 100 150 150 100 150')
    
    return contours
```

### Шаг 3: Настройте параметры генерации сетки

```python
# Основная функция для создания сетки
def create_mesh(
    pixel_spacing,          # Соотношение пиксель/мм [x, y]
    polygons,               # Список контуров
    lc=7,                   # Размер элемента сетки
    distance_threshold=1.3, # Порог для слияния коллинеарных точек
    skin_width=0,           # Толщина "кожи" (0 - нет, -1 - внутренняя)
    is_show_inner_contours=False, # Показывать внутренние контуры
    show_meshing_result_method="opencv", # "gmsh", "opencv" или "no"
    number_of_showed_class=-1,    # Какой класс скрыть (-1 - все видимы)
    is_exporting_to_femm=True,    # Экспорт в FEMM
    export_filename="output.txt"  # Имя файла для экспорта
)
```

### Шаг 4: Запустите генерацию

```python
# Способ 1: Используйте тестовую функцию
test_module(my_custom_example())

# Способ 2: Вызовите create_mesh напрямую
from femm_generator import create_mesh

result = create_mesh(
    pixel_spacing=[1, 1],
    polygons=my_custom_example(),
    lc=5,
    skin_width=0,
    is_show_inner_contours=True,
    show_meshing_result_method="opencv",
    is_exporting_to_femm=True,
    export_filename="my_mesh.txt"
)
```

## Советы по созданию контуров

### 1. **Порядок точек**
- Точки должны следовать последовательно по контуру
- Первая и последняя точка обычно совпадают (замкнутый контур)

### 2. **Классификация элементов**
- Класс 0 обычно используется для внешнего контура
- Разные классы для разных материалов/свойств
- Классы должны быть целыми числами

### 3. **Оптимизация геометрии**
- Избегайте очень маленьких элементов
- Используйте `distance_threshold` для упрощения контуров
- Удаляйте коллинеарные точки для уменьшения сложности

### 4. **Пример простого прямоугольника**
```python
# Прямоугольник 100x100
contours = [
    '0 0 0 100 0 100 100 0 100',  # Внешний контур
    '1 20 20 80 20 80 80 20 80'   # Внутреннее отверстие
]
```

### 5. **Пример круга (аппроксимация многоугольником)**
```python
import math

def create_circle(cx, cy, radius, segments=20, class_id=0):
    points = []
    for i in range(segments):
        angle = i * 2 * math.pi / segments
        x = cx + radius * math.cos(angle)
        y = cy + radius * math.sin(angle)
        points.extend([x, y])
    
    # Замыкаем круг
    points.extend([cx + radius, cy])
    
    return f'{class_id} ' + ' '.join(f'{p:.1f}' for p in points)
```

## Обработка ошибок

1. **Нечетное количество координат** — убедитесь, что у каждого контура четное количество чисел (пары x,y)
2. **Некорректный class_id** — должен быть целым числом
3. **Пересекающиеся контуры** — избегайте пересечений между контурами одного класса
4. **Очень маленькие элементы** — увеличьте `lc` или упростите геометрию

## Выходные данные

### 1. **FEMM-формат файла**
```
# NODES
1 0.000000 0.000000
2 100.000000 0.000000
...

# TRIANGLES
1 2 3 0
4 5 6 1
...
```

### 2. **Визуализация**
- Gmsh GUI: интерактивный просмотр
- OpenCV изображение: сохранение как PNG/JPG

## Расширенные возможности

### Выборка определенного класса
```python
# Показать только элементы класса 2
result = create_mesh(
    polygons=my_example(),
    show_meshing_result_method="gmsh",
    number_of_showed_class=2,
    # ... другие параметры
)
```

## Тестирование

Для быстрой проверки используйте встроенную тестовую функцию:
```python
from femm_generator import test_module

# Тестовый пример из файла
test_module()

# Или ваш собственный пример
test_module(my_custom_example())
```
